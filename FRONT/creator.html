<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>–ü–∞–Ω–µ–ª—å –î–∏–∑–∞–π–Ω–µ—Ä–∞</h1>
        
    </header>
   
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
    <div>
        <canvas id="votesChart" width="400" height="200"></canvas>
    </div>

    <br>
    <p id="username">üë§:–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</p>
    <div class="date-display" id="selectedDateDisplay">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</div>

    <div class="circle-container" id="circleContainer"></div>

    <div class="upload-container" id="uploadSection" style="display: none;">
        <input type="file" id="fileUpload" accept="image/*">
        <button id="uploadButton">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" -->
    <button id="backButton" class="back-button"  onclick="Nazad()">–ù–∞–∑–∞–¥</button>

    <script src="script.js"></script>
</body>
</html>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    height: 100vh;
    background-color: #e0ecfa;
    position: relative; /* –î–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
}

header {
    width: 100%;
    padding: 10px;
    background-color: #512da8;
    color: white;
    text-align: center;
}

.date-display {
    margin: 20px 0;
    font-size: 18px;
    color: #512da8;
    background-color: #c2c3f9;
    padding: 10px;
    width: 100%;
    text-align: center;
    border-radius: 5px;
    max-width: 400px;
}

.circle-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

.circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #512da8;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.circle:hover {
    background-color: #9888dc;
}

.circle.selected {
    background-color: #525157;
}

.upload-container {
    margin-top: 20px;
}

#uploadButton {
    padding: 10px 20px;
    background-color: #512da8;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#uploadButton:hover {
    background-color: #311b92;
}

/* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
.back-button {
    position: absolute; /* –§–∏–∫—Å–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É */
    bottom: 60px; /* –û—Ç—Å—Ç—É–ø –æ—Ç –Ω–∏–∑–∞ */
    left: 50%;
    transform: translateX(-50%); /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É */
    padding: 10px 20px;
    background-color: #512da8;
    color: white;
    border: none;
    border-radius: 30px; /* –û–≤–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ */
    font-size: 25px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.back-button:hover {
    background-color: #311b92;
}
</style>




<script>
document.addEventListener("DOMContentLoaded", async function () {
        // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ URL
const urlParts = window.location.pathname.split('/'); // –†–∞–∑–¥–µ–ª—è–µ–º –ø—É—Ç—å URL
const userId = urlParts[urlParts.length - 1]; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ user_id ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –ø—É—Ç–∏

    // // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
    // try {
    //     const response = await fetch(`/api/users/${userId}`);
    //     if (response.ok) {
    //         const userData = await response.json();
    //         usernameElement.textContent = userData.name; // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    //     } else {
    //         usernameElement.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–º—è";
    //     }
    // } catch (error) {
    //     console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
    //     usernameElement.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
    // }

    // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç—ã —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –∏ –≥–æ–ª–æ—Å–∞–º–∏
    const circleContainer = document.getElementById("circleContainer");
    const selectedDateDisplay = document.getElementById("selectedDateDisplay");
    const uploadSection = document.getElementById("uploadSection");
    const uploadButton = document.getElementById("uploadButton");
    const fileUpload = document.getElementById("fileUpload");

    const year = 2024;
    const month = 9;

    const votesData = {
        dates: [], // –î–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        votes: []  // –ì–æ–ª–æ—Å–∞: 1 –≥–æ–ª–æ—Å 2 —Å–µ–Ω—Ç—è–±—Ä—è –∏ 2 –≥–æ–ª–æ—Å–∞ 3 —Å–µ–Ω—Ç—è–±—Ä—è
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
    const ctx = document.getElementById('votesChart').getContext('2d');
    const votesChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: votesData.dates,
            datasets: [{
                label: '–í—ã –ø–æ–∫–∞ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏',
                data: votesData.votes,
                borderColor: 'rgba(153, 119, 241, 1)',
                backgroundColor: 'rgba(153, 119, 241, 0.5)',
                fill: true,
            }]
        },
        options: {
            scales: {
                x: { title: { display: true, text: '–î–∞—Ç–∞' } },
                y: { title: { display: true, text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤' } }
            }
        }
    });

    const updateChart = () => {
        votesChart.update();
    };

    const getMondays = (year, month) => {
        const mondays = [];
        const date = new Date(year, month, 1);

        while (date.getDay() !== 1) {
            date.setDate(date.getDate() + 1);
        }

        while (date.getMonth() === month) {
            mondays.push(new Date(date));
            date.setDate(date.getDate() + 7);
        }

        return mondays;
    };

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–æ–≤ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞
    const mondays = getMondays(year, month);
    mondays.forEach((monday) => {
        const circle = document.createElement("div");
        circle.className = "circle";
        circle.textContent = monday.getDate();

        circle.addEventListener("click", function () {
            selectedDateDisplay.textContent = `–í—ã –≤—ã–±—Ä–∞–ª–∏: ${monday.toLocaleDateString("ru-RU")}`;
            document.querySelectorAll('.circle').forEach(c => c.classList.remove('selected'));
            circle.classList.add('selected');
            uploadSection.style.display = "block";
        });

        circleContainer.appendChild(circle);
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
    uploadButton.addEventListener("click", function () {
        const selectedCircle = document.querySelector('.circle.selected');
        const file = fileUpload.files[0];
        const selectedDate = selectedCircle ? selectedCircle.textContent : null;

        if (!file || !selectedDate) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏ –¥–∞—Ç—É.");
            return;
        }

        const fileName = `${year}-${month + 1}-${selectedDate}-${file.name}`;
        alert(`–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é: ${fileName}`);
    });

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
    window.addEventListener("message", function (event) {
        if (event.data && event.data.vote && event.data.date) {
            const { vote, date } = event.data;

            if (vote === 2) {
                if (!votesData.dates.includes(date)) {
                    votesData.dates.push(date);
                    votesData.votes.push(1);
                } else {
                    const index = votesData.dates.indexOf(date);
                    votesData.votes[index]++;
                }

                updateChart();
            }
        }
    });

    function Nazad() {
        window.location.href = 'index.html';
    }



// –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API
const usernameElement = document.getElementById('username'); // –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
try {
    const response = await fetch(`/api/users/${userId}`);
    if (response.ok) {
        const userData = await response.json();
        usernameElement.textContent = userData.name; // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    } else {
        usernameElement.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–º—è";
    }
} catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", error);
    usernameElement.textContent = "Profile";
}
})

</script>